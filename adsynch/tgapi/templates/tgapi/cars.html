{% extends 'main/layout2.html' %}

{% block cars %}

<div class="container mt-4 cars">
    <div class="row">

        <div class="col-md-9"> <!-- Make the main content wider towards the left -->

            {% for ad in car_ads %}
            <div class="card mb-4"> <!-- Added margin bottom for spacing -->
                <div class="card-body" style="display: flex;">
                    <div style="flex: 1; max-width: 200px; max-height: 150px; overflow: hidden;">
                        <img id="main-image-{{ forloop.counter }}" style="width: 100%; height: 120px; object-fit: cover;">
                    </div>
                    <div style="flex: 2; padding: 0 20px;">
                        <a href="{% url 'carad-detail' pk=ad.pk %}"><h5 class="card-title">{{ ad.car_brand }} {{ ad.car_model }}</h5></a>
                        <p class="card-text">
                            <strong>Год выпуска:</strong> {{ ad.car_year }}<br>
                            <strong>Цена:</strong> {{ ad.car_price }} {{ currency }}<br>
                            <strong>Местоположение:</strong> {{ ad.car_location }}
                        </p>
                    </div>
                </div>
            </div>


            <script>
                var photoUrls{{ forloop.counter }} = "{{ car_ad.photos }}".split(",");
                console.log("photoUrls{{ forloop.counter }}:", photoUrls{{ forloop.counter }});

                var mainImage{{ forloop.counter }} = document.getElementById("main-image-{{ forloop.counter }}");

                if (photoUrls{{ forloop.counter }}.length >= 1) {
                    mainImage{{ forloop.counter }}.src = photoUrls{{ forloop.counter }}[0].trim();

                    if (photoUrls{{ forloop.counter }}.length >= 2) {
                        mainImage{{ forloop.counter }}.setAttribute("data-hover-src", photoUrls{{ forloop.counter }}[1].trim());

                        mainImage{{ forloop.counter }}.addEventListener('mouseover', function() {
                            mainImage{{ forloop.counter }}.src = mainImage{{ forloop.counter }}.getAttribute("data-hover-src");
                        });

                        mainImage{{ forloop.counter }}.addEventListener('mouseout', function() {
                            mainImage{{ forloop.counter }}.src = photoUrls{{ forloop.counter }}[0].trim();
                        });
                    }
                }
            </script>
                    {% empty %}
            <li>No car ads found.</li>
        {% endfor %}

        </div>


<div class="col-md-3">
    <!-- Sidebar with sorting and filters -->
    <div id="sidebar" class="p-3 ">
        <h5 class="text-danger">Сортировка</h5>
        <div class="mb-3">
            <select onchange="window.location=this.value" class="form-select">
                <option value="?{{ request.GET.urlencode }}&order_by=-date_published">Новинки</option>
                <option value="?{{ request.GET.urlencode }}&order_by=views">Сортировка по просмотрам (минимум)</option>
                <option value="?{{ request.GET.urlencode }}&order_by=-views">Сортировка по просмотрам (максимум)</option>
                <option value="?{{ request.GET.urlencode }}&order_by=car_price">Сортировка по цене (дешевые)</option>
                <option value="?{{ request.GET.urlencode }}&order_by=-car_price">Сортировка по цене (дорогие)</option>
            </select>
        </div>
        <form method="get">
            <!-- Поля для фильтров -->
<div class="form-group">
    <label for="id_brand">Бренд:</label>
    <select name="brand" id="id_brand" class="form-control">
        {% for choice in filter.form.brand.field.choices %}
            <option value="{{ choice.0 }}" {% if filter.data.brand == choice.0 %}selected{% endif %}>{{ choice.1 }}</option>
        {% endfor %}
    </select>
</div>
            <div class="form-group">
                <label for="id_model">Модель:</label>
                <input type="text" name="model" id="id_model" value="{{ request.GET.model }}" class="form-control">
            </div>
            <div class="form-group">
                <label for="id_price_min">Цена Min:</label>
                <input type="number" name="price_min" id="id_price_min" value="{{ request.GET.price_min }}" class="form-control">
            </div>
            <div class="form-group">
                <label for="id_price_max">Цена Max:</label>
                <input type="number" name="price_max" id="id_price_max" value="{{ request.GET.price_max }}" class="form-control">
            </div>
            <div class="form-group">
                <label for="id_mileage_min">Пробег Min:</label>
                <input type="number" name="mileage_min" id="id_mileage_min" value="{{ request.GET.mileage_min }}" class="form-control">
            </div>
            <div class="form-group">
                <label for="id_mileage_max">Пробег Max:</label>
                <input type="number" name="mileage_max" id="id_mileage_max" value="{{ request.GET.mileage_max }}" class="form-control">
            </div>
            <div class="form-group">
                <label for="id_year_min">Год Min:</label>
                <input type="number" name="year_min" id="id_year_min" value="{{ request.GET.year_min }}" class="form-control">
            </div>
            <div class="form-group">
                <label for="id_year_max">Год Max:</label>
                <input type="number" name="year_max" id="id_year_max" value="{{ request.GET.year_max }}" class="form-control">
            </div>
            <div class="form-group">
                <label for="id_condition">Состояние:</label>
                <input type="text" name="condition" id="id_condition" value="{{ request.GET.condition }}" class="form-control">
            </div>
            <button type="submit" class="btn btn-danger">Filter</button>
        </form>
    </div>
</div>
        </div>
    </div>
{% endblock %}