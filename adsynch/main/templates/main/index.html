{% extends 'main/layout.html' %}
{% block index %}
{% load static %}


<main>


    <section class="obv-1">
        <h3 class="text-center" style="margin-bottom: 8vh;">Поиск авто</h3>


<form id="filterForm" method="GET">
    <div class="row">
        <div class="col-md-4 form-group">
            <label for="select-make">Марка авто:</label>
            <select class="form-control" name="car_brand" id="select-make">
                <option value="">Любая</option>
                {% for car_brand in car_brands %}
                    <option value="{{ car_brand }}" {% if car_brand == request.GET.car_brand %} selected {% endif %}>
                        {{ car_brand }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4 form-group">
            <label for="select-model">Модель авто:</label>
            <select class="form-control" name="car_model" id="select-model">
                <option value="">Любая</option>
                {% for car_model in car_models %}
                    <option value="{{ car_model }}" {% if car_model == request.GET.car_model %} selected {% endif %}>
                        {{ car_model }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4 form-group">
            <label for="select-year">Год выпуска:</label>
            <select class="form-control" name="car_year" id="select-year">
                <option value="">Любой</option>
                {% for car_year in car_years %}
                    <option value="{{ car_year }}" {% if car_year == request.GET.car_year %} selected {% endif %}>
                        {{ car_year }}
                    </option>
                {% endfor %}
            </select>
        </div>
    </div>
</form>

<script>
    document.querySelectorAll(".form-control").forEach(function(select) {
        select.addEventListener('change', function() {
            document.getElementById("filterForm").submit();
        });
    });
</script>



<div class="row">
    {% for car in filtered_cars %}
        <div class="col-md-3">
            <div class="card">
                <img id="main-image-{{ forloop.counter }}" class="card-img-top img-fluid" alt="...">
                <div class="card-body">
                    <h5 class="card-title">{{ car.car_brand }} {{ car.car_model }}</h5>
                    <p class="card-text">Цена: {{ car.car_price }} {{ car.currency }}</p>
                    <p class="card-text">Год выпуска: {{ car.car_year }}</p>
                    <p class="card-text">Дата публикации: {{ car.publish_date }}</p>
                    <a href="{% url 'car_detail' car.id %}" class="btn btn-danger">Подробнее</a>
                </div>
            </div>
        </div>

        <script>
            var photoUrls{{ forloop.counter }} = "{{ car.photos }}".split(",");
            var mainImage{{ forloop.counter }} = document.getElementById("main-image-{{ forloop.counter }}");
            var counter = {{ forloop.counter }};

            mainImage{{ forloop.counter }}.style.width = "420px";
            mainImage{{ forloop.counter }}.style.height = "240px";

            if (photoUrls{{ forloop.counter }}.length >= 2) {
                mainImage{{ forloop.counter }}.src = photoUrls{{ forloop.counter }}[0].trim();
                mainImage{{ forloop.counter }}.setAttribute("data-hover-src", photoUrls{{ forloop.counter }}[1].trim());

                mainImage{{ forloop.counter }}.addEventListener('mouseover', function() {
                    mainImage{{ forloop.counter }}.src = mainImage{{ counter }}.getAttribute("data-hover-src");
                });

                mainImage{{ forloop.counter }}.addEventListener('mouseout', function() {
                    mainImage{{ forloop.counter }}.src = photoUrls{{ counter }}[0].trim();
                });
            }
        </script>
    {% endfor %}
</div>
</section>
<!--<script>-->
<!--document.addEventListener('DOMContentLoaded', function() {-->
<!--    document.querySelectorAll('.form-control').forEach(function(select) {-->
<!--        select.addEventListener('change', function() {-->
<!--            var selectedMake = document.getElementById('select-make').value;-->
<!--            var selectedModel = document.getElementById('select-model').value;-->
<!--            var selectedYear = document.getElementById('select-year').value;-->

<!--            var cards = document.querySelectorAll('.card');-->
<!--            var parent = cards[0].parentNode;-->

<!--            var sortedCards = Array.from(cards).sort(function(a, b) {-->
<!--                var getCarInfo = function(card) {-->
<!--                    var titleParts = card.querySelector('.card-title').textContent.trim().split(' ');-->
<!--                    var make = titleParts[0];-->
<!--                    var model = titleParts[1];-->
<!--                    var year = card.querySelector('.card-text:nth-child(3)').textContent.trim().split(': ')[1];-->
<!--                    return { make, model, year };-->
<!--                };-->

<!--                var carInfoA = getCarInfo(a);-->
<!--                var carInfoB = getCarInfo(b);-->

<!--                if (-->
<!--                    (selectedMake === "" || carInfoA.make === selectedMake) &&-->
<!--                    (selectedModel === "" || carInfoA.model === selectedModel) &&-->
<!--                    (selectedYear === "" || carInfoA.year === selectedYear)-->
<!--                ) {-->
<!--                    return -1;-->
<!--                } else if (-->
<!--                    (selectedMake === "" || carInfoB.make === selectedMake) &&-->
<!--                    (selectedModel === "" || carInfoB.model === selectedModel) &&-->
<!--                    (selectedYear === "" || carInfoB.year === selectedYear)-->
<!--                ) {-->
<!--                    return 1;-->
<!--                } else {-->
<!--                    return 0;-->
<!--                }-->
<!--            });-->

<!--            parent.innerHTML = "";-->
<!--            sortedCards.forEach(function(card) {-->
<!--                parent.appendChild(card);-->
<!--            });-->
<!--        });-->
<!--    });-->
<!--});-->
<!--    </script>-->

    <section class="checkin">

        <div class="row justify-content-center">
            <div class="col-md-6 text-center">
                <h3>Есть вопросы? Мы свяжемся с вами!</h3>
                <p>И мы сами свяжемся с вами в течение 10 минут и ответим на все ваши вопросы</p>

                <form class="form-inline justify-content-center">
                    <div class="form-group mr-4">
                        <input type="text" class="form-control" id="fullname" placeholder="Введите ваше ФИО">
                    </div>
                    <div class="form-group mr-4">

                        <input type="tel" class="form-control" id="phone" placeholder="Ваш номер телефона">
                    </div>

                    <button type="submit" class="btn btn-danger">Отправить</button>
                </form>
            </div>
        </div>

    </section>

</main>


{% endblock %}